<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Chronicles - Astronomy News</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link rel="manifest" href="/manifest.json">
   <meta name="theme-color" content="#4a6fa5">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
   <meta name="apple-mobile-web-app-title" content="Cosmic Chronicles">
   <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
</head>
<body class="AN-body">
    <!-- Header Section -->
    <header class="AN-header">
        <div class="AN-container">
            <div class="AN-header-content">
                <!-- Column 1: Logo (1/4) -->
                <div class="AN-logo-section">
                    <a href="index.html" class="AN-logo-link">
                        <div class="AN-logo fallback-logo">
                            <img src="assets/icons/icon-96x96.png" alt="Cosmic Chronicles Logo" onerror="this.style.display='none'; this.parentElement.classList.add('fallback-logo')">
                            <i class="fas fa-star" style="display: none;"></i>
                        </div>
                    </a>
                </div>
                
                <!-- Column 2: Title (2/4) -->
                <div class="AN-title-section">
                    <h1 class="AN-title" data-i18n="An.index.title">Cosmic Chronicles</h1>
                </div>
                
                <!-- Column 3: Options Card (1/4) -->
                <div class="AN-options-card">
                    <div class="AN-controls-compact">
                        <div class="AN-control-group">
                            <label for="AN-language-select" class="AN-control-label" data-i18n="An.index.language">Language:</label>
                            <select id="AN-language-select" class="AN-select">
                                <option value="en">English</option>
                                <option value="fr">Fran√ßais</option>
                                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                            </select>
                        </div>
                        
                        <div class="AN-control-group">
                            <div class="AN-theme-toggle">
                                <input type="checkbox" id="AN-theme-switch" class="AN-theme-checkbox">
                                <label for="AN-theme-switch" class="AN-theme-slider">
                                    <span class="AN-theme-icon AN-theme-sun"><i class="fas fa-sun"></i></span>
                                    <span class="AN-theme-icon AN-theme-moon"><i class="fas fa-moon"></i></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="AN-control-group">
                            <button class="AN-notification-btn" id="AN-notification-toggle">
                                <i class="fas fa-bell"></i>
                                <span class="AN-notification-badge" id="AN-notification-badge">0</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="AN-nav">
                <ul class="AN-nav-list">
                    <li class="AN-nav-item"><a href="index.html" class="AN-nav-link" data-i18n="An.index.home">Home</a></li>
                    <li class="AN-nav-item"><a href="AN_news.html" class="AN-nav-link AN-active" data-i18n="An.index.news">News</a></li>
                    <li class="AN-nav-item"><a href="AN_missions.html" class="AN-nav-link" data-i18n="An.index.missions">Missions</a></li>
                    <li class="AN-nav-item"><a href="AN_gallery.html" class="AN-nav-link" data-i18n="An.index.gallery">Gallery</a></li>
                    <li class="AN-nav-item"><a href="AN_explore.html" class="AN-nav-link" data-i18n="An.index.explore">Explore Astronomy</a></li>
                    <li class="AN-nav-item"><a href="AN_about.html" class="AN-nav-link" data-i18n="An.index.about">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content - News Page Layout -->
    <main class="AN-main">
        <div class="AN-container">
            <!-- Page Header -->
            <div class="AN-page-header">
                <h2 class="AN-page-title" data-i18n="An.news.title">Astronomy News</h2>
                <p class="AN-page-subtitle" data-i18n="An.news.subtitle">Latest discoveries and updates from the universe</p>
                
                <!-- Filter Options -->
                <div class="AN-news-filter">
                    <button class="AN-filter-btn AN-filter-active" data-filter="all" data-i18n="An.index.allNews">All News</button>
                    <button class="AN-filter-btn" data-filter="global" data-i18n="An.index.globalNews">Global News</button>
                    <button class="AN-filter-btn" data-filter="local" data-i18n="An.index.localNews">Tunisia News</button>
                    <button class="AN-filter-btn" data-filter="latest" data-i18n="An.news.latest">Latest First</button>
                    <button class="AN-filter-btn" data-filter="oldest" data-i18n="An.news.oldest">Oldest First</button>
                </div>
            </div>
            
            <!-- 3-Column News Layout -->
            <div class="AN-news-layout">
                <!-- Column 1: News List (1/3) -->
                <div class="AN-news-sidebar">
                    <div class="AN-news-list-header">
                        <h3 data-i18n="An.news.recentNews">Recent News</h3>
                        <span class="AN-news-count" id="AN-news-count">6 articles</span>
                    </div>
                    
                    <div class="AN-news-list" id="AN-news-list">
                        <!-- News list items will be dynamically generated here -->
                    </div>
                </div>
                
                <!-- Column 2 & 3: Main Article (2/3) -->
                <div class="AN-main-article" id="AN-main-article">
                    <!-- Main article will be dynamically generated here -->
                    <!-- Default content shows the latest news -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="AN-footer">
        <div class="AN-container">
            <div class="AN-footer-content">
                <!-- Column 1: Information -->
                <div class="AN-footer-section">
                    <h3 class="AN-footer-title" data-i18n="An.index.aboutUs">About Us</h3>
                    <p class="AN-footer-text" data-i18n="An.index.aboutText">Cosmic Chronicles brings you the latest news and discoveries from the world of astronomy and space exploration.</p>
                </div>
                
                <!-- Column 2: Developer -->
                <div class="AN-footer-section">
                    <h3 class="AN-footer-title" data-i18n="An.index.developer">Developer</h3>
                    <p class="AN-footer-text">Mejri Ziad</p>
                </div>
                
                <!-- Column 3: Quick Links -->
                <div class="AN-footer-section">
                    <h3 class="AN-footer-title" data-i18n="An.index.quickLinks">Quick Links</h3>
                    <ul class="AN-footer-links">
                        <li><a href="index.html" data-i18n="An.index.home">Home</a></li>
                        <li><a href="AN_news.html" data-i18n="An.index.news">News</a></li>
                        <li><a href="AN_missions.html" data-i18n="An.index.missions">Missions</a></li>
                        <li><a href="AN_gallery.html" data-i18n="An.index.gallery">Gallery</a></li>
                        <li><a href="AN_explore.html" data-i18n="An.index.explore">Explore Astronomy</a></li>
                        <li><a href="AN_about.html" data-i18n="An.index.about">About</a></li>
                    </ul>
                </div>
                
                <!-- Column 4: Legal -->
                <div class="AN-footer-section">
                    <h3 class="AN-footer-title" data-i18n="An.index.legal">Legal</h3>
                    <ul class="AN-footer-links">
                        <li><a href="#" data-i18n="An.index.privacyPolicy">Privacy Policy</a></li>
                        <li><a href="#" data-i18n="An.index.termsOfUse">Terms of Use</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Notification Panel -->
    <div class="AN-notification-panel" id="AN-notification-panel">
        <div class="AN-notification-header">
            <h3 data-i18n="An.index.notifications">Notifications</h3>
            <button class="AN-close-btn" id="AN-close-notifications">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="AN-notification-list" id="AN-notification-list">
            <!-- Notifications will be dynamically generated here -->
        </div>
    </div>

    <script src="data.js"></script>
<script src="data_processing.js"></script>
    <script src="translation.js"></script>
   <script src="data.js"></script>
<script src="data_processing.js"></script>
<script src="translation.js"></script>
<script>
    // Add news-specific translations
    const AN_news_translations = {
        en: {
            'An.news.title': 'Astronomy News',
            'An.news.subtitle': 'Latest discoveries and updates from the universe',
            'An.news.latest': 'Latest First',
            'An.news.oldest': 'Oldest First',
            'An.news.recentNews': 'Recent News',
            'An.news.readTime': 'min read',
            'An.news.tunisiaNews': 'Tunisia News',
            'An.news.globalNews': 'Global News',
            'An.news.readMore': 'Read more',
            'An.news.category': 'Category',
            'An.news.author': 'Author',
            'An.news.share': 'Share',
            'An.news.related': 'Related News',
            'An.news.backToList': 'Back to News List'
        },
        fr: {
            'An.news.title': 'Actualit√©s Astronomiques',
            'An.news.subtitle': 'Derni√®res d√©couvertes et mises √† jour de l\'univers',
            'An.news.latest': 'Plus r√©cent',
            'An.news.oldest': 'Plus ancien',
            'An.news.recentNews': 'Actualit√©s R√©centes',
            'An.news.readTime': 'min de lecture',
            'An.index.localNews': 'Actualit√©s Tunisie',
            'An.index.globalNews': 'Actualit√©s Mondiales',
            'An.index.readMore': 'Lire la suite',
            'An.news.category': 'Cat√©gorie',
            'An.news.author': 'Auteur',
            'An.news.share': 'Partager',
            'An.news.related': 'Actualit√©s Similaires',
            'An.news.backToList': 'Retour √† la liste'
        },
        ar: {
            'An.news.title': 'ÿ£ÿÆÿ®ÿßÿ± ÿßŸÑŸÅŸÑŸÉ',
            'An.news.subtitle': 'ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿßŸÉÿ™ÿ¥ÿßŸÅÿßÿ™ ŸàÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ŸÖŸÜ ÿßŸÑŸÉŸàŸÜ',
            'An.news.latest': 'ÿßŸÑÿ£ÿ≠ÿØÿ´ ÿ£ŸàŸÑÿßŸã',
            'An.news.oldest': 'ÿßŸÑÿ£ŸÇÿØŸÖ ÿ£ŸàŸÑÿßŸã',
            'An.news.recentNews': 'ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿ≠ÿØŸäÿ´ÿ©',
            'An.news.readTime': 'ÿØŸÇŸäŸÇÿ© ŸÑŸÑŸÇÿ±ÿßÿ°ÿ©',
            'An.index.localNews': 'ÿ£ÿÆÿ®ÿßÿ± ÿ™ŸàŸÜÿ≥',
            'An.index.globalNews': 'ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿπÿßŸÑŸÖŸäÿ©',
            'An.index.readMore': 'ÿßŸÇÿ±ÿ£ ÿßŸÑŸÖÿ≤ŸäÿØ',
            'An.news.category': 'ÿßŸÑŸÅÿ¶ÿ©',
            'An.news.author': 'ÿßŸÑŸÉÿßÿ™ÿ®',
            'An.news.share': 'ŸÖÿ¥ÿßÿ±ŸÉÿ©',
            'An.news.related': 'ÿ£ÿÆÿ®ÿßÿ± ÿ∞ÿßÿ™ ÿµŸÑÿ©',
            'An.news.backToList': 'ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿÆÿ®ÿßÿ±'
        }
    };

    // Merge news translations with existing translations
    Object.keys(AN_news_translations).forEach(lang => {
        if (AN_translations[lang]) {
            Object.assign(AN_translations[lang], AN_news_translations[lang]);
        }
    });

    // Helper function to get query parameters
    function AN_getQueryParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    // Helper function to get proper share URL
    function AN_getShareUrl(articleId) {
        // Use your actual Netlify domain
        const baseUrl = 'https://univers-chronicals.netlify.app';
        return `${baseUrl}/AN_news.html?article=${articleId}`;
    }

    // Function to render news list (left column)
    function AN_renderNewsList(language, filter = 'all', sort = 'latest') {
        const newsList = document.getElementById('AN-news-list');
        const newsCount = document.getElementById('AN-news-count');
        
        if (!newsList) return;
        
        // Clear existing content
        newsList.innerHTML = '';
        
        // Get news data
        let newsData = AN_data.filter(item => item.type === 'news');
        
        // Apply filter
        if (filter !== 'all') {
            newsData = newsData.filter(item => item.category === filter);
        }
        
        // Apply sorting
        if (sort === 'latest') {
            newsData.sort((a, b) => new Date(b.date) - new Date(a.date));
        } else if (sort === 'oldest') {
            newsData.sort((a, b) => new Date(a.date) - new Date(b.date));
        }
        
        // Update news count
        if (newsCount) {
            const articleText = newsData.length === 1 ? 'article' : 'articles';
            newsCount.textContent = `${newsData.length} ${articleText}`;
        }
        
        // If no news found
        if (newsData.length === 0) {
            newsList.innerHTML = `
                <div class="AN-no-news">
                    <i class="fas fa-newspaper"></i>
                    <p>No news found for this filter.</p>
                </div>
            `;
            return;
        }
        
        // Render each news item
        newsData.forEach((item, index) => {
            const content = item[language] || item.en;
            
            // Check if this should be active (first item or matching URL parameter)
            const articleIdFromUrl = AN_getQueryParam('article');
            let isActive = index === 0;
            if (articleIdFromUrl && item.id === articleIdFromUrl) {
                isActive = true;
            }
            const activeClass = isActive ? 'AN-news-item-active' : '';
            
            const newsItem = document.createElement('div');
            newsItem.className = `AN-news-item ${activeClass}`;
            newsItem.setAttribute('data-id', item.id);
            newsItem.setAttribute('data-category', item.category);
            
            // Calculate read time (approx 200 words per minute)
            const wordCount = content.body.split(' ').length;
            const readTime = Math.ceil(wordCount / 200);
            
            newsItem.innerHTML = `
                <div class="AN-news-item-image">
                    <div class="AN-news-item-image-inner" style="background-image: url('${item.image}')">
                        ${!item.image ? `<div class="AN-image-placeholder ${item.category === 'local' ? 'AN-mars-rover' : 'AN-james-webb'}"></div>` : ''}
                    </div>
                    <span class="AN-news-item-badge ${item.category === 'local' ? 'AN-local-badge' : 'AN-global-badge'}" title="${item.category === 'local' ? AN_translations[language]['An.index.localNews'] : AN_translations[language]['An.index.globalNews']}">
                        ${item.category === 'local' ? 'TN' : 'üåç'}
                    </span>
                </div>
                <div class="AN-news-item-content">
                    <h4 class="AN-news-item-title">${content.title}</h4>
                    <p class="AN-news-item-excerpt">${content.subtitle || content.body.substring(0, 80)}...</p>
                    <div class="AN-news-item-meta">
                        <span class="AN-news-item-date">${AN_formatDate(item.date, language)}</span>
                        <span class="AN-news-item-readtime">${readTime} ${AN_translations[language]['An.news.readTime'] || 'min read'}</span>
                    </div>
                </div>
            `;
            
            // Add click event
            newsItem.addEventListener('click', function() {
                // Remove active class from all items
                document.querySelectorAll('.AN-news-item').forEach(item => {
                    item.classList.remove('AN-news-item-active');
                });
                
                // Add active class to clicked item
                this.classList.add('AN-news-item-active');
                
                // Update URL without reloading page
                const articleId = this.getAttribute('data-id');
                if (history.pushState) {
                    const newUrl = `${window.location.pathname}?article=${articleId}`;
                    window.history.pushState({ articleId }, '', newUrl);
                }
                
                // Load the article
                AN_loadArticle(articleId, language);
            });
            
            newsList.appendChild(newsItem);
        });
        
        // Load the first article by default, or the one from URL
        if (newsData.length > 0) {
            const articleIdFromUrl = AN_getQueryParam('article');
            if (articleIdFromUrl) {
                // Check if article exists
                const articleExists = newsData.some(item => item.id === articleIdFromUrl);
                if (articleExists) {
                    AN_loadArticle(articleIdFromUrl, language);
                } else {
                    AN_loadArticle(newsData[0].id, language);
                }
            } else {
                AN_loadArticle(newsData[0].id, language);
            }
        }
    }

    // Function to load and display an article
    function AN_loadArticle(articleId, language) {
        const mainArticle = document.getElementById('AN-main-article');
        const articleData = AN_getDataById(articleId);
        
        if (!mainArticle || !articleData) return;
        
        const content = articleData[language] || articleData.en;
        
        // Get related articles (same category, excluding current)
        const relatedArticles = AN_data
            .filter(item => item.type === 'news' && 
                           item.category === articleData.category && 
                           item.id !== articleId)
            .slice(0, 3);
        
        // Calculate read time
        const wordCount = content.body.split(' ').length;
        const readTime = Math.ceil(wordCount / 200);
        
        mainArticle.innerHTML = `
            <article class="AN-article">
                <div class="AN-article-header">
                    <div class="AN-article-category">
                        <span class="AN-article-badge ${articleData.category === 'local' ? 'AN-local-badge' : 'AN-global-badge'}">
                            ${articleData.category === 'local' ? AN_translations[language]['An.index.localNews'] : AN_translations[language]['An.index.globalNews']}
                        </span>
                        <span class="AN-article-date">${AN_formatDate(articleData.date, language)}</span>
                    </div>
                    <h1 class="AN-article-title">${content.title}</h1>
                    <p class="AN-article-subtitle">${content.subtitle}</p>
                    <div class="AN-article-meta">
                        <span class="AN-article-readtime">
                            <i class="far fa-clock"></i> ${readTime} ${AN_translations[language]['An.news.readTime'] || 'min read'}
                        </span>
                        <button class="AN-article-share">
                            <i class="fas fa-share-alt"></i> ${AN_translations[language]['An.news.share'] || 'Share'}
                        </button>
                    </div>
                </div>
                
                <div class="AN-article-image">
                    <div class="AN-article-image-inner" style="background-image: url('${articleData.image}')">
                        ${!articleData.image ? `<div class="AN-image-placeholder ${articleData.category === 'local' ? 'AN-mars-rover' : 'AN-james-webb'}"></div>` : ''}
                    </div>
                </div>
                
                <div class="AN-article-content">
                    <div class="AN-article-body">
                        ${content.body.split('\n').map(paragraph => `<p>${paragraph}</p>`).join('')}
                    </div>
                    
                    ${relatedArticles.length > 0 ? `
                    <div class="AN-article-related">
                        <h3 class="AN-article-related-title">
                            <i class="fas fa-newspaper"></i> ${AN_translations[language]['An.news.related'] || 'Related News'}
                        </h3>
                        <div class="AN-article-related-grid">
                            ${relatedArticles.map(related => {
                                const relatedContent = related[language] || related.en;
                                return `
                                    <div class="AN-related-article" data-id="${related.id}">
                                        <div class="AN-related-image" style="background-image: url('${related.image}')"></div>
                                        <h4>${relatedContent.title}</h4>
                                        <p>${relatedContent.subtitle || relatedContent.body.substring(0, 60)}...</p>
                                        <a href="#" class="AN-related-link">${AN_translations[language]['An.index.readMore']} ‚Üí</a>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            </article>
        `;
        
        // Add click events to related articles
        document.querySelectorAll('.AN-related-article').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const relatedId = this.getAttribute('data-id');
                
                // Update active state in list
                document.querySelectorAll('.AN-news-item').forEach(listItem => {
                    listItem.classList.remove('AN-news-item-active');
                    if (listItem.getAttribute('data-id') === relatedId) {
                        listItem.classList.add('AN-news-item-active');
                    }
                });
                
                // Update URL without reloading page
                if (history.pushState) {
                    const newUrl = `${window.location.pathname}?article=${relatedId}`;
                    window.history.pushState({ articleId: relatedId }, '', newUrl);
                }
                
                // Load the related article
                AN_loadArticle(relatedId, language);
                
                // Scroll to top of article on mobile
                if (window.innerWidth < 768) {
                    mainArticle.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
        
        // Add share functionality
        const shareBtn = mainArticle.querySelector('.AN-article-share');
        if (shareBtn) {
            shareBtn.addEventListener('click', function() {
                // Create shareable URL
                const shareUrl = AN_getShareUrl(articleId);
                const shareTitle = content.title;
                const shareText = content.subtitle || content.title;
                
                if (navigator.share) {
                    // Use Web Share API if available
                    navigator.share({
                        title: shareTitle,
                        text: shareText,
                        url: shareUrl
                    });
                } else {
                    // Fallback: Copy to clipboard
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        // Show success feedback
                        const originalHTML = shareBtn.innerHTML;
                        shareBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        shareBtn.style.backgroundColor = '#2ecc71';
                        
                        setTimeout(() => {
                            shareBtn.innerHTML = originalHTML;
                            shareBtn.style.backgroundColor = '';
                        }, 2000);
                    }).catch(err => {
                        // Show error feedback
                        const originalHTML = shareBtn.innerHTML;
                        shareBtn.innerHTML = '<i class="fas fa-times"></i> Failed';
                        shareBtn.style.backgroundColor = '#e74c3c';
                        
                        setTimeout(() => {
                            shareBtn.innerHTML = originalHTML;
                            shareBtn.style.backgroundColor = '';
                        }, 2000);
                    });
                }
            });
        }
    }

    // Function to apply translations for news page
    function AN_applyNewsTranslations(language) {
        AN_applyTranslations(language);
        
        // Get current filter and sort
        const activeFilter = document.querySelector('.AN-filter-active')?.getAttribute('data-filter') || 'all';
        const activeSort = document.querySelector('.AN-filter-active[data-filter="latest"], .AN-filter-active[data-filter="oldest"]')?.getAttribute('data-filter') || 'latest';
        
        // Render news list with current settings
        AN_renderNewsList(language, activeFilter, activeSort);
        
        // Re-render notifications
        AN_renderNotifications(language);
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Theme toggle functionality
        const themeSwitch = document.getElementById('AN-theme-switch');
        const body = document.body;
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('AN-theme') || 
                          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        if (savedTheme === 'dark') {
            body.classList.add('AN-dark-mode');
            themeSwitch.checked = true;
        }
        
        themeSwitch.addEventListener('change', function() {
            if (this.checked) {
                body.classList.add('AN-dark-mode');
                localStorage.setItem('AN-theme', 'dark');
            } else {
                body.classList.remove('AN-dark-mode');
                localStorage.setItem('AN-theme', 'light');
            }
        });
        
        // Notification panel toggle
        const notificationToggle = document.getElementById('AN-notification-toggle');
        const notificationPanel = document.getElementById('AN-notification-panel');
        const closeNotifications = document.getElementById('AN-close-notifications');
        
        notificationToggle.addEventListener('click', function() {
            notificationPanel.classList.toggle('AN-active');
        });
        
        closeNotifications.addEventListener('click', function() {
            notificationPanel.classList.remove('AN-active');
        });
        
        // Close notification panel when clicking outside
        document.addEventListener('click', function(event) {
            if (!notificationToggle.contains(event.target) && 
                !notificationPanel.contains(event.target)) {
                notificationPanel.classList.remove('AN-active');
            }
        });

        // Language selection
        const languageSelect = document.getElementById('AN-language-select');
        const savedLanguage = localStorage.getItem('AN-language-preference') || 'en';
        
        if (languageSelect) {
            languageSelect.value = savedLanguage;
            languageSelect.addEventListener('change', function() {
                AN_applyNewsTranslations(this.value);
            });
        }
        
        // Filter button functionality
        const filterButtons = document.querySelectorAll('.AN-filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all filter buttons
                filterButtons.forEach(btn => btn.classList.remove('AN-filter-active'));
                
                // Add active class to clicked button
                this.classList.add('AN-filter-active');
                
                // Get filter and sort values
                const filter = this.getAttribute('data-filter');
                const language = languageSelect ? languageSelect.value : 'en';
                
                // Determine if this is a sort button
                const isSort = filter === 'latest' || filter === 'oldest';
                
                // Get current active filter (excluding sort)
                let activeFilter = 'all';
                filterButtons.forEach(btn => {
                    const btnFilter = btn.getAttribute('data-filter');
                    if (btn.classList.contains('AN-filter-active') && 
                        btnFilter !== 'latest' && btnFilter !== 'oldest') {
                        activeFilter = btnFilter;
                    }
                });
                
                // Get current sort
                let activeSort = 'latest';
                filterButtons.forEach(btn => {
                    const btnFilter = btn.getAttribute('data-filter');
                    if (btn.classList.contains('AN-filter-active') && 
                        (btnFilter === 'latest' || btnFilter === 'oldest')) {
                        activeSort = btnFilter;
                    }
                });
                
                // Apply the appropriate action
                if (isSort) {
                    // This is a sort button, keep current filter
                    AN_renderNewsList(language, activeFilter, filter);
                } else {
                    // This is a filter button, keep current sort
                    AN_renderNewsList(language, filter, activeSort);
                }
            });
        });
        
        // Initialize with saved language
        AN_applyNewsTranslations(savedLanguage);
        
        // Add refresh button for notifications
        const refreshBtn = document.createElement('button');
        refreshBtn.className = 'AN-notification-refresh';
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
        refreshBtn.title = 'Refresh notifications';
        refreshBtn.addEventListener('click', function() {
            const language = document.getElementById('AN-language-select').value;
            // Clear saved notifications to force refresh
            localStorage.removeItem(`AN_notifications_${language}`);
            AN_renderNotifications(language);
        });
        
        // Add refresh button to notification header
        const notificationHeader = document.querySelector('.AN-notification-header');
        if (notificationHeader) {
            notificationHeader.appendChild(refreshBtn);
        }
    });
</script>
</body>
</html>